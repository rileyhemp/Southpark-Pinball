{"version":3,"sources":["flipper.js"],"names":["Flipper","scene","x","y","options","blockOffsetX","blockOffsetY","blockRotation","stopperOffsetX","stopperOffsetY","flipperOffsetX","flipperOffsetY","torque","staticTorque","flipperLength","isFlipping","block","matter","add","image","isStatic","scaleX","scaleY","visible","rotation","stopper","pivot","setScale","setCircle","setStatic","rectA","Phaser","Physics","Matter","Bodies","rectangle","chamfer","rectB","flipperBody","body","create","parts","flipperBodyInner","flipper","setExistingBody","setVisible","flipperInner","restitution","setBounce","pin","constraint","stiffness","length","pin2","pin3","positionPin","forEach","el","setCollisionCategory","flipperCollisionGroup","collisionGroupA","setCollidesWith","collisionGroupB","LeftFlipper","pointA","pointB","RightFlipper"],"mappings":"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","sourcesContent":["\r\n//set a circle in the beginning of the flipper and constrain it to the pivot directly. no offset. \r\n\r\nclass Flipper {\r\n    constructor(scene, x, y, options){\r\n        this.scene = scene\r\n        this.x = x\r\n        this.y = y\r\n        this.blockOffsetX = 25\r\n        this.blockOffsetY = 45\r\n        this.blockRotation = .50\r\n        this.stopperOffsetX = 25\r\n        this.stopperOffsetY = -23\r\n        this.flipperOffsetX = 25\r\n        this.flipperOffsetY = 5\r\n        this.torque = -9\r\n        this.staticTorque = 2 \r\n        this.flipperLength = 78\r\n        this.isFlipping = false\r\n    }\r\n    createComponents(){\r\n        \r\n        //Bottom block\r\n        this.block = this.scene.matter.add.image(this.x + this.blockOffsetX,this.y + this.blockOffsetY, 'rectA', this.scene, {\r\n            isStatic: true\r\n        })\r\n        this.block.scaleX = .1\r\n        this.block.scaleY = .3\r\n        this.block.visible = false\r\n        this.block.rotation = this.blockRotation\r\n\r\n        //Top block\r\n        this.stopper = this.scene.matter.add.image(this.x + this.stopperOffsetX,this.y + this.stopperOffsetY ,'rectA', this.scene, {\r\n            isStatic: true\r\n        })\r\n        this.stopper.scaleX = .1\r\n        this.stopper.scaleY = .4\r\n        this.stopper.visible = false\r\n\r\n        //Pivot point\r\n        this.pivot = this.scene.matter.add.image(this.x, this.y, null, this.scene)\r\n        this.pivot.setScale(.2)\r\n        this.pivot.setCircle(1)\r\n        this.pivot.setStatic(true)\r\n\r\n        //Flipper \r\n        //The flipper is made up of two rectangles, one slightly smaller then the other. The reason for this is that the ball would occassionally miss the flipper at high speed, \r\n        //and the second rectangle is there as a backup. It works most of the time, but is not ideal. \r\n        //\r\n        let rectA = Phaser.Physics.Matter.Matter.Bodies.rectangle(this.x + this.flipperOffsetX , this.y + this.flipperOffsetY, this.flipperLength, 24, {\r\n            chamfer: 10,\r\n        })\r\n        let rectB = Phaser.Physics.Matter.Matter.Bodies.rectangle(this.x + this.flipperOffsetX , this.y + this.flipperOffsetY, this.flipperLength, 16, {\r\n            chamfer: 10,\r\n        })\r\n        this.flipperBody = this.scene.matter.body.create({\r\n            parts: [ rectA ]\r\n        })\r\n        this.flipperBodyInner = this.scene.matter.body.create({\r\n            parts: [ rectB ]\r\n        })\r\n        \r\n        this.flipper = this.scene.matter.add.image(150, 0, null).setExistingBody(this.flipperBody).setVisible(false)\r\n        this.flipperInner = this.scene.matter.add.image(150, 0, null).setExistingBody(this.flipperBodyInner).setVisible(false)\r\n        this.flipper.body.restitution = 0.1\r\n        this.flipper.setBounce(0.2)\r\n        this.flipperInner.setBounce(0.2)\r\n\r\n        //Joint\r\n        this.pin = this.scene.matter.add.constraint(this.pivot, this.flipper)\r\n        this.pin.stiffness = 0.9\r\n        this.pin.length = 0\r\n\r\n\r\n        this.pin2 = this.scene.matter.add.constraint(this.pivot, this.flipperInner)\r\n        this.pin2.stiffness = 0.9\r\n        this.pin2.length = 0\r\n\r\n\r\n        this.pin3 = this.scene.matter.add.constraint(this.flipper, this.flipperInner)\r\n        this.pin3.stiffness = 0.9\r\n        this.pin3.length = 0\r\n        this.positionPin()\r\n    }\r\n\r\n    setCollisionGroups(){\r\n        [ this.block, this.stopper ].forEach( el => {\r\n            el.setCollisionCategory(flipperCollisionGroup)\r\n        })\r\n        \r\n        this.flipper.setCollisionCategory(collisionGroupA)\r\n        this.flipper.setCollidesWith([ collisionGroupA, flipperCollisionGroup ])\r\n\r\n        this.flipperInner.setCollisionCategory(collisionGroupB)\r\n        this.flipperInner.setCollidesWith([ collisionGroupA, flipperCollisionGroup ])\r\n\r\n    }\r\n\r\n    flip(){\r\n        this.flipper.body.torque = this.torque\r\n        if(this.isFlipping){\r\n            this.flipper.body.torque = this.torque\r\n        }\r\n        //When flipping, increase the friction of the ball (simulates rubbers)\r\n        // ball.setFriction(1)\r\n        // setTimeout(() => {\r\n        //     ball.setFriction(0)\r\n        // }, 100)\r\n    }\r\n\r\n    hold(){\r\n        if (this.isFlipping){\r\n            this.flipper.body.torque = -this.staticTorque\r\n        }\r\n    }\r\n    release(){\r\n        this.flipper.body.torque = this.staticTorque\r\n    }\r\n\r\n}\r\n\r\nclass LeftFlipper extends Flipper {\r\n    constructor(scene, x, y){\r\n        super(scene, x, y)\r\n        super.createComponents()\r\n        super.setCollisionGroups()\r\n    }\r\n    positionPin(){\r\n        this.pin.pointA = {\r\n            x: 5,  \r\n            y: 5\r\n        }\r\n        this.pin.pointB = {\r\n            x: -this.flipperLength/2+3, \r\n            y: 0\r\n        }\r\n        this.pin2.pointA = {\r\n            x: 5,\r\n            y: 5\r\n        }\r\n        this.pin2.pointB = {\r\n            x: -this.flipperLength/2+3, \r\n            y: 0\r\n        }\r\n    }\r\n}\r\n\r\nclass RightFlipper extends Flipper {\r\n    constructor(scene, x, y){\r\n        super(scene, x, y)\r\n        this.blockOffsetX = -this.blockOffsetX\r\n        this.blockRotation = -this.blockRotation\r\n        this.stopperOffsetX = -this.stopperOffsetX\r\n        this.flipperOffsetX = -this.flipperOffsetX\r\n        this.torque = -this.torque\r\n        this.staticTorque = -this.staticTorque\r\n        super.createComponents()\r\n        super.setCollisionGroups()\r\n    }\r\n    positionPin(){\r\n        this.pin.pointA = {\r\n            x: -5,  \r\n            y: 5\r\n        }\r\n        this.pin.pointB = {\r\n            x: this.flipperLength/2-3, \r\n            y: 0\r\n        }\r\n        this.pin2.pointA = {\r\n            x: -5,\r\n            y: 5\r\n        }\r\n        this.pin2.pointB = {\r\n            x: this.flipperLength/2-3, \r\n            y: 0\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n"],"file":"flipper.js"}